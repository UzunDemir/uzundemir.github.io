# 3. Data Understanding. Excel

## 3.9 Итоги пройденных тем. Проверьте себя. Часть 1

Пришло время практики. 

Ваша цель — отработать навык расчётов при помощи уже известного вам инструмента Excel.

Представьте себя в роли исследователя и аналитика данных. Вам предстоит поработать с разными вопросами: начиная с демографической ситуации в мире, заканчивая данными о пассажирах известного вам британского трансатлантического парохода. 

Обратите внимание: это не тест, а практическая работа. Лучше заложить несколько часов на её выполнение.

Приступим? 

Начнём с исследования демографической ситуации в мире:

Рассчитаем плотность населения мира двумя способами.
Сравним результаты и попробуем объяснить их.
Рассчитаем плотность населения частей света.
Скачайте датасет [countries.xlsx.](https://github.com/UzunDemir/uzundemir.github.io/blob/master/other_files/%D0%9A%D0%BE%D0%BF%D0%B8%D1%8F%20countries.xlsx)

Не забудьте закрепить заголовок таблицы и выделить его цветом.

Если вы проходили практику после модулей, то уже знакомы с этим датасетом и знаете, что в нём есть следующие колонки:

region — название части света, на территории которой располагается страна;
population — население страны (количество людей, которые в ней проживают);
total — общая площадь страны по суше и водной поверхности в квадратных километрах;.
total_land — площадь суши страны в квадратных километрах;
total_water — площадь водной поверхности страны в квадратных километрах.

Итак, рассчитайте среднюю плотность населения всего мира с помощью формулы ниже. Все данные есть в вашей таблице.

Плотность населения = население / площадь


Получится количество людей на один квадратный километр.



Что нужно сделать

Создайте новый лист, назовите его density (англ. «плотность»).
В ячейку A1 введите заголовок world_avg1.
В ячейку A2 — формулу средней плотности населения мира. 

[Ответ:](https://github.com/UzunDemir/uzundemir.github.io/blob/master/other_pages/answer_1.md)

Теперь рассчитаем плотность населения мира другим способом — как среднее плотностей населений каждой отдельной страны.

Для страны плотность считается так же, как и для всего мира — население страны делится на площадь страны. 

Что нужно сделать

Вернитесь на лист countries. Правее колонки region создайте новый столбец density. 
Заполните столбец density плотностями населения каждой страны. 
После расчёта плотности населения всех стран и территорий перейдите на лист density. В ячейку B1 введите заголовок world_avg2.
В ячейку B2 введите формулу: ещё раз посчитайте среднюю плотность населения мира, но на этот раз как среднее плотностей населения всех стран (среднее от колонки countries!density).

[Ответ:](https://github.com/UzunDemir/uzundemir.github.io/blob/master/other_pages/answer_2.md)

Мы видим, что результаты очень сильно отличаются:

![image](https://user-images.githubusercontent.com/94790150/219924034-bcc689eb-bc4a-4a91-966d-19659f226a12.png)


Как вы думаете, почему так произошло при разном способе подсчёта? 

[Ответ:](https://github.com/UzunDemir/uzundemir.github.io/blob/master/other_pages/answer_3.md)

Теперь посчитайте этими же двумя способами среднюю плотность населения каждой части света: Africa, America, Asia, Europe, Oceania.



Что нужно сделать

Выделите все данные на листе countries и вставьте сводную таблицу в новый лист.
Добавьте строки — части света. Укажите значения — средние значения по столбцу density. 
Теперь добавьте ещё одно значение для расчёта, но на этот раз выберите не колонку таблицы countries, а рассчитываемое поле.

Рассчитываемое поле — это возможность задать нестандартную, «кастомную» формулу в рамках сводной таблицы. 

![image](https://user-images.githubusercontent.com/94790150/219924680-81461f1d-6817-42bb-a071-92c497897671.png)


Рассчитайте среднюю плотность по частям света так: =population/total.

Обратите внимание: синтаксис формул в сводных таблицах немного отличается. Для адресации колонок оригинальной таблицы используйте имена её колонок из первой строки.

[Ответ:](https://github.com/UzunDemir/uzundemir.github.io/blob/master/other_pages/answer_4.md)

Если остались вопросы, изучите [таблицу с верными расчётами.](https://github.com/UzunDemir/uzundemir.github.io/blob/master/other_files/%D0%9A%D0%BE%D0%BF%D0%B8%D1%8F%20countries_hw1_reference.xlsx)

## 3.10 Итоги пройденных тем. Проверьте себя. Часть 2

В этой работе отвлечёмся от демографии и поработаем с датасетом, который создан на основе одного из самых популярных тренировочных датасетов в Data Science — с «Титаником». Тысячи тьюториалов используют этот датасет, и мы тоже с ним познакомимся. 

Напоминаем, что ваша цель — отработать навык расчётов при помощи Excel.

Обратите внимание: это не тест, а практическая работа. Лучше заложить несколько часов на её выполнение.

В этой работе вы:

Исследуете датасет на наличие пропусков.
Проверите три гипотезы о выживаемости в зависимости от: 
пола;
класса обслуживания;
богатства кают.
Заполните пропуски в столбце с выживаемостью на основе знаний, полученных в ходе проверки гипотез. 
Сначала скачайте датасет [titanic_smpl.xlsx.](https://github.com/UzunDemir/uzundemir.github.io/blob/master/other_files/%D0%9A%D0%BE%D0%BF%D0%B8%D1%8F%20titanic_smpl.xlsx)

Он содержит данные о пассажирах «Титаника» — британского трансатлантического парохода, который столкнулся с айсбергом в апреле 1912 года и затонул в Северной Атлантике. Массовая культура не могла обойти стороной трагедию такого масштаба. Судьбе парохода посвящено множество книг, песен, кинематографических и анимационных фильмов и даже компьютерных игр.

В колонках есть пропуски. Узнайте, сколько их.

Что нужно сделать

На отдельном листе создайте таблицу с заголовками, как у оригинальной.
В ячейках под заголовками укажите количество пропусков в соответствующих колонках основной таблицы.
Назовите новый лист Missings.
В каких колонках есть пропуски? 



Чтобы посчитать пропуски, можно воспользоваться функцией «СЧИТАТЬПУСТОТЫ()». В скобках должен быть указан диапазон ячеек, в которых мы ищем пропуски.*





Колонки в датасете:

PassengerId — идентификатор пассажира.

Survived — признак, который указывает, выжил ли пассажир после крушения: 1 — выжил, 0 — нет.

Pclass — класс обслуживания пассажира.

Sex — пол пассажира.

Age — возраст пассажира.

SibSp — общее количество братьев, сестёр, жён и мужей, с которыми путешествовал пассажир.

Parch — общее количество детей и родителей, с которыми путешествовал пассажир.

Fare — сумма денег, которую пассажир заплатил за билет.

Embarked — это буква, которая кодирует порт отправления пассажира (S — Саутгемптон, Q — Куинстаун, C — Шербур).

Несколько верных ответов: 

*На самом деле пропуски есть в колонках Survived (100), Age (177) и Embarked (2).*

В колонке Embarked пропусков совсем немного, не заполняйте их. 

Колонка Age — числовая, вы уже несколько раз заполняли пропуски в таких колонках мерами среднего уровня. Если хотите, сделайте это прямо сейчас. 

Наша главная задача — заполнить колонку Survived. Чтобы понять, как лучше всего это сделать, нужно проверить гипотезу. 

Итак, мы знаем, что с «Титаника» сначала спасали женщин и состоятельных пассажиров. Поэтому давайте возьмём такую гипотезу: значения колонки Survived зависят от пола пассажира («Sex») и переменных, описывающих его материальное благосостояние (класс обслуживания «Pclass» и цена билета «Fare»). 

Давайте сначала проверим зависимость от пола, а затем перейдёем к классу обслуживания и цене билета. 

Приступим?

Для начала ответим на вопрос: зависит ли выживаемость от пола (Sex)?



Что нужно сделать

Создайте сводную таблицу. Добавьте строки — значения колонки Sex. Также добавьте два значения (это будут столбцы нашей таблицы):

количество мужчин и женщин, которые были на борту; 

количество мужчин и женщин, которые выжили (для колонки Survived: 0 — утонул, 1 — выжил; поэтому количество выживших — это сумма нулей и единиц).

Проверяем — у вас должна получиться таблица, в которой четыре строки (с учётом заголовка и строки «итого») и три столбца A, B и C (с учётом заголовка). 
Сейчас в столбцах — абсолютные значения, пересчитайте их в проценты. Для ячеек сводной таблицы можно задавать формулы, как и во всех остальных таблицах. Подсказка: чтобы узнать, какой процент x составляет от y, надо x поделить на y и умножить на 100. Добавьте такие формулы в ячейки D2, D3 и D4, чтобы они содержали:

процент выживших женщин от всех женщин, 

процент выживших мужчин от всех мужчин,

процент выживших от общего числа всех выживших людей.

Переименуйте лист со сводной таблицей, пусть он называется Sex.

Ответ:

*Процент выживших женщин — ~66,88, а мужчин — ~16,46. Если первое разделить на второе, то выйдет ~4,06 (то есть женщин в четыре с лишним раза больше).*

Но не торопитесь заполнять пропуски Survived, делая вывод, что женщины выживают лучше, чем мужчины. Можно улучшить решение.  

Помните, гипотеза включала в себя предположение, что есть также зависимость от класса обслуживания и цены билета? 

Давайте теперь определим, есть ли зависимость от класса обслуживания (Pclass). 

Что нужно сделать

Создайте ещё одну сводную таблицу на новом листе. На этот раз со строками Sex и Pclass, но значения будут теми же: сколько было всего и сколько выжило. 
В колонке справа от таблицы (скорее всего, это будет колонка E) укажите, какой процент выживших в каждой группе (для каждой строки).

Назовите этот лист Sex_Pclass.

Ответ:

*Верно. Богатые женщины из первого класса выжили в ~90,43% случаях.*

Класс обслуживания мог быть один, но богатство кают — разное. От него зависела и цена билета. В нашей изначальной гипотезе говорилось, что приоритет при спасении с «Титаника» отдавался и тем, кто купил более дорогой билет.

Итак, последний шаг перед заполнением пропусков в столбце Survived — определить, зависела ли выживаемость от богатства кают.

Что нужно сделать

Шаги такие же, как и в прошлых двух задачах, но для начала нужно подготовиться.

Если вы попытаетесь добавить в строку сводной таблицы колонку Fare, то столкнётесь с трудностью: колонка Fare — числовая, а числа в ней — дробные. Использовать её в сводной таблице в таком виде не получится, поэтому создайте правее от колонки Fare новую колонку, назовите её Fare_class и заполните следующим образом:  

если значение Fare меньше 10, то значение Fare_class равно 4;  

если значение Fare больше или равно 10, но меньше 20, то значение Fare_class равно 3;

если значение Fare больше или равно 20, но меньше 30, то значение Fare_class равно 2;  

если значение Fare больше или равно 30, то значение Fare_class равно 1.    


Совет

Вы можете реализовать это с помощью функции IF, которую мы разбирали в материалах. Однако при её использовании придётся составить комбинацию функций, что не очень удобно синтаксически. Другая функция (IFS) позволяет легко комбинировать условия. Прочитайте справку об этой функции. Вы будете часто обращаться к документации при прохождении курса и в дальнейшей работе. 



Пример применения этой функции: IFS(A1>90; "Число больше 90"; A1>80; "Число в диапазоне 81-90"; A1>70; "Число в диапазоне 71-80"). Чтобы понять, как она работает, скопируйте формулу в таблицу и попробуйте ввести разные значения в ячейку A1. 

Ещё один пример: он абстрактный и поможет лучше понять функцию (но работу этой формулы не получится проверить в таблице): IFS(ДЗ=легкое; "Это ДЗ будет легким"; ДЗ=интересное; "ДЗ непростое, но зато интересное").

Ответ:

*Отлично! Формулы должны быть такого вида: =IFS(H2<10; 4; H2<20; 3; H2<30; 2; H2>=30; 1)*

Итак, теперь у вас есть колонка Fare_class, которая содержит числа от 1 до 4. Она отражает как бы класс цены билета: 1 — самые дорогие билеты, 4 — самые дешёвые. Теперь переходим к созданию сводной таблицы.



Что нужно сделать

Сделайте новую сводную таблицу, в которой по строкам будет три измерения (пол, класс обслуживания, класс цены билета), а значения — такие же, как два раза до этого. 
В колонке правее от таблицы (должна быть колонка F) пересчитайте в проценты долю выживших в каждой группе.

Назовите этот лист Sex_Pclass_Fareclass.

Отлично, мы убедились, что вероятность выжить на «Титанике» была выше у пассажиров определённого пола, которые щедро заплатили за определённый класс обслуживания. Теперь можем вернуться к заполнению пропусков в колонке Survived.

Будем руководствоваться правилом: если выживаемость в группе выше 50%, то можно считать, что типичный представитель этой группы выживет, а если ниже — то нет. 

Ответ:

*Процент выживаемости ниже 50% у всех мужчин (вне зависимости от класса обслуживания и класса билета), а также у женщин третьего класса, которые заплатили больше или меньше 20 за билет (female, Pclass 3, Fare_class 1 и 2). Это мы видим по расчётам процентов в последней сводной таблице Sex_Pclass_Fareclass.*

*Убедитесь, что вы всё правильно сделали. Выживаемость должна быть выше всего у богатых женщин из первого класса, которые находились в самых дорогих каютах (~90,9%).* 

Всё необходимое мы выяснили. Наконец перейдём к заполнению пропусков в столбце Survived.



Что нужно сделать

Создайте новый столбец в основной таблице с данными, назовите его Survived_full. 

Заполните столбец по алгоритму:

Если в колонке Survived есть значение, то берите его.

Если в колонке Survivedзначения нет, то:

Если пол male, ставьте 0.

Если пол female, Pclass — 3, а Fare — больше или равно 20, то ставьте 0.

Во всех остальных случаях — 1.

Реализуйте этот алгоритм с помощью комбинации функций ISBLANK и IF и заполните колонку Survived_full. Удачи!

Ответ:

*Сравним формулы? =IF(ISBLANK(B2);IF(E2="male"; 0; IF(D2=3; IF(I2>=20; 0; 1); 1)); B2)*

В ходе этой работы вы ответили на большое количество исследовательских вопросов и получили много инсайтов из датасета «Титаник».

Говоря на языке аналитики, вы поработали с данными, проведя предварительное исследование и заполнив пропуски, и заодно отработали навык расчётов в Excel. 

Вероятно, это было непросто. Надеемся, что вы понимаете, что сделанное вами — уже настоящий Data Science. Добро пожаловать в клуб, коллеги!

Если остались вопросы по этой работе, изучите [таблицу с верными расчётами.](https://github.com/UzunDemir/uzundemir.github.io/blob/master/other_files/%D0%9A%D0%BE%D0%BF%D0%B8%D1%8F%20titanic_smpl.xlsx%20%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B4%D0%BB%D1%8F%20%D0%BB%D0%BE%D0%BD%D0%B3%D1%80%D0%B8%D0%B4%D0%B0.xlsx)
