---
layout: post
title:  "3. Uploading data with SQL"
---

![sql_cod](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/924b6684-dc0a-4e81-9c71-c1ba462d0fe9)

[Руководство по стилю SQL · SQL Style Guide](https://www.sqlstyle.guide/ru/)


[3.1 Инструкция DataGrip.pdf](https://github.com/UzunDemir/uzundemir.github.io/files/11550506/3.1.DataGrip.pdf)

[3.1 Инструкция DBeaver.pdf](https://github.com/UzunDemir/uzundemir.github.io/files/11550507/3.1.DBeaver.pdf)

[3.1 Создание таблиц.pdf](https://github.com/UzunDemir/uzundemir.github.io/files/11550508/3.1.pdf)

## 1. Выберим базу Pet care clinic на [сайте](https://uibakery.io/sql-playground):

![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/00e65f55-2f52-41fe-99af-0737809d85e9)

## 2. Подключим базу в DBeaver. Введем хост, порт (если он отсутствует), имя пользователя, пароль и имя базы.

![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/0f0e90ea-960f-4cda-a25d-c1023a784762)

## 3. Выведем все доступные таблицы из схемы public. Их должно быть всего три: animals, appointments и owners.

Этот запрос выводит список всех таблиц в базе данных, включая их схемы. Конкретно, он выводит два столбца: "schemaname" и "tablename". Столбец "schemaname" содержит имена схем, в которых находятся таблицы, а столбец "tablename" содержит имена таблиц. Вы можете использовать этот запрос в PostgreSQL для получения списка всех таблиц в базе данных. Вот пример запроса:
```sql
SELECT schemaname, tablename
FROM pg_catalog.pg_tables
WHERE schemaname != 'pg_catalog' AND schemaname != 'information_schema';
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/7e5b280e-b0cc-42e9-9c6c-c77b81d16d2a)

Этот скрипт использует системную таблицу information_schema.tables, которая содержит информацию о всех таблицах в базе данных. Он выбирает только те таблицы, которые находятся в схеме "public", и сортирует их по имени таблицы в алфавитном порядке.
Обратите внимание, что в PostgreSQL имена и схем регистрозависимы, поэтому если вы используете другой регистр для имени схемы, то вам нужно будет изменить условие table_schema = 'public' в соответствии с вашими потребностями.
```sql
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/3ece49b8-9a0b-4af2-ab1b-8553f5570b24)

Этот скрипт использует системную таблицу pg_catalog.pg_tables, которая содержит информацию о всех таблицах в базе данных. Он выбирает только те таблицы, которые находятся в схеме "public", и сортирует их по имени таблицы в алфавитном порядке.
Обратите внимание, что в PostgreSQL имена и схемы регистрозависимы, поэтому если вы используете другой регистр для имени схемы, то вам нужно будет изменить условие schemaname = 'public' в соответствии с вашими потребноями.
```sql
SELECT tablename
FROM pg_catalog.pg_tables
WHERE schemaname = 'public'
ORDER BY tablename;
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/7ed3b336-81dd-42ad-81c6-97a034dcae6f)

Этот скрипт использует системную таблицу pg_class, которая содержит информацию о всех объектах данных, включая таблицы. Он выбирает только те таблицы, которые находятся в схеме "public", и сортирует их по имени таблицы в афавитном порядке.
Обратите внимание, что в PostgreSQL имена и схемы регистрозависимы, поэтому если вы используете другой регистр для имени схемы, то вам нужно будет изменить условие nspname = 'public' в соответствии с вашими потребностями.
```sql
SELECT relname
FROM pg_class
WHERE relkind = 'r' AND relnamespace = (SELECT oid FROM pg_namespace WHERE nspname = 'public')
ORDER BY relname;
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/c3fcf0ce-eda2-474c-85da-4d0ecdd74922)

## 4. Создадим новые таблицы из исходных. Например, обрезав несколько полей.

Выведем вообще какие столбцы имеются в таблицых, например 'appointments' 
```sql
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'appointments';
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/2afb6740-ccb6-4712-9896-c7ee715708a0)

```sql
SELECT column_name
FROM information_schema.columns
WHERE table_name = 'animals';
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/f4c71097-7753-4b91-a29b-e3f91d2bb0be)

Чтобы вывести названия всех таблиц и их столбцы в PostgreSQL из схемы 'public', вы можете использовать следующий SQL-запрос:
```sql
SELECT table_name, column_name
FROM information_schema.columns
WHERE table_schema = 'public'
ORDER BY table_name, ordinal_position;
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/156dea01-25fa-4764-9b98-70eebaabe792)

Этот запрос использует системную таблицу information_schema.columns, которая содержит информацию о столбцах всех таблиц в базе данных. Здесь мы выбираем только те строки, где схема таблицы равна 'public', чтобы получить только таблицы из этой схемы.
Запрос вернет список всех таблиц и их столбцов в алфавитном порядке. Столбцы для каждой таблицы будут отображаться в порядке их позиции в таблице.
Если вы хотите вывести дополнительную информацию о таблицах, такую как их типы данных или ограничения, вы можете добавить соответствующие столбцы из таблицы information_schema.columns в запрос.
Например, чтобы вывести имена таблиц, их столбцы, и типы данных каждого столбца в схеме 'public', вы можете использовать следующий запрос:

```sql
SELECT table_name, column_name, data_type
FROM information_schema.columns
WHERE table_schema = 'public'
ORDER BY table_name, ordinal_position;
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/c5ef6fcb-5659-4412-abcc-8733a764659b)
```sql
CREATE TABLE new_animals (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  type VARCHAR(255) NOT NULL,
  age INTEGER NOT NULL,
  registered_at TIMESTAMP NOT NULL,
  owner_id INTEGER NOT NULL
)
INSERT INTO new_animals (name, type, age, registered_at, owner_id)
SELECT name, type, age, to_timestamp(registered_at, 'YYYY-MM-DD HH24:MI:SS'), owner_id
FROM animals
select * from new_animals
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/13486a74-7d9b-4dfc-8f47-4282436e4398)

Для вывода первых и последних 10 строк таблицы можно использовать разные подходы в зависимости от используемой СУБД. Вот несколько примеров:
Для PostgreSQL:

```sql
SELECT *
FROM (
  SELECT *
  FROM new_animals
  ORDER BY id ASC
  LIMIT 10
) AS first_rows
UNION ALL
SELECT *
FROM (
  SELECT *
  FROM new_animals
  ORDER BY id DESC
  LIMIT 10
) AS last_rows
ORDER BY id ASC;
```
![image](https://github.com/UzunDemir/uzundemir.github.io/assets/94790150/f950b52d-3433-4a52-a82a-f46bcfd632e0)

Приведем в первоначальный вид - удалим созданные таблицы и оставим только как было вначале - animals, appointments и owners.
Вариант удаления всех таблиц, кроме animals, appointments и owners, без перечисления удаляемых таблиц в PostgreSQL - это использовать запрос на удаление таблиц, который генерируетинамический SQL на основе информации из системной таблицы pg_tables. Вот пример такого запроса:
```sql
DO $$ DECLARE
    r RECORD;
BEGIN
    FOR r IN (SELECT tablename FROM pg_tables WHERE schemaname = 'public' AND tablename NOT IN ('animals', 'appointments', 'owners'))
    LOOP
        EXECUTE 'DROP TABLE IF EXISTS ' || quote_ident(r.tablename) || ' CASCADE';
    END LOOP;
END $$;
```
## Выводы

Таким образом, я вам показал как формировать запросы для GPT для быстрого и углубленного изучения материала.
